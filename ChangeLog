2011-04-21  Bob Friesenhahn  <bfriesen@simple.dallas.tx.us>

	* PerlMagick/Magick.xs: AdaptiveThreshold offset argument was
	being parsed into an 'unsigned long' rather than 'double' as it
	should have been.  This resulted in inability to handle negative
	offsets. Fixes SourceForge bug 3288735 "PerlMagick issue with
	AdaptiveThreshold".

	* coders/jpeg.c (ReadIPTCProfile): JPEG may deliver IPTC profile
	in chunks but code was only allowing one chunk, even though it was
	otherwise prepared to concatenate chunks.  Fixes SourceForge bug
	2978422 "Clipping paths in JPG images are truncated".

	* magick/utility.c (GetToken): Fix case where parser may run off
	end of string.  Also add asserts to check for passing null
	pointer.

2011-04-10  Bob Friesenhahn  <bfriesen@simple.dallas.tx.us>

	* magick/channel.c (ChannelImage): Report an error if the
	requested channel is not compatible with the image colorspace.
	Only deals with CMYK/RGB conflicts.  Resolves SourceForge issue
	3283046 "Bug in CMYK".

2011-03-15  Bob Friesenhahn  <bfriesen@simple.dallas.tx.us>

	* coders/txt.c (ReadTXTImage): Throw error if attempt to read
	empty file.

	* coders/{fits.c,mac.c,miff.c,pcd.c,pict.c,ps3.c,rla.c,txt.c}:
	Format requires seekable stream.

	* coders/pnm.c (WritePNMImage): Implement writer for PAM format.

	* coders/ept.c (WriteEPTImage): Fix error handling for case when
	TIFF writer fails.

	* magick/constitute.c (ReadImage): Use of GetBlobStatus() to
	evaluate image reader success is bogus.
	(MagickGetQuantumSamplesPerPixel): New private method to return
	the number of samples returned per pixel for a given quantum type.

2011-03-14  Glenn Randers-Pehrson  <glennrp@simple...>

	* coders/png.c (WriteOnePNGImage(): Fixed a rounding error in
	writing the pHYs chunk (it was truncating instead of rounding).

2011-02-20  Bob Friesenhahn  <bfriesen@simple.dallas.tx.us>

	* magick/magick.c (MagickPanicSignalHandler,MagickSignalHandler):
	Don't invoke DestroyMagick() since there may be OpenMP worker
	threads still running which are using data which would be
	deallocated.  Instead we invoke PurgeTemporaryFiles() to remove
	any existing temporary files. Valgrind will report leaks if the
	program is terminated by a signal but this causes no actual harm.
	Resolves SourceForge issue 3165456 "^C causes semaphore failure in
	MacOSX".
	(MagickPanicSignalHandler): Invoke abort() in panic signal handler
	so that we will reliably get a core dump.

	* magick/tempfile.c (PurgeTemporaryFiles): New private function to
	remove any existing temporary files but without destroying
	temporary file semaphore.

2011-02-13  Bob Friesenhahn  <bfriesen@simple.dallas.tx.us>

	* coders/pnm.c (ReadPNMImage): Fix mis-placed break in PAM header
	parser.

	* wand/magick_wand.c (MagickWriteImageBlob): Improve the
	documentation to mention the related use of MagickSetImageFormat()
	and MagickResetIterator().

2011-02-07  Bob Friesenhahn  <bfriesen@simple.dallas.tx.us>

	* magick/xwindow.c (MagickXBestFont): Check for a few more common
	font names, and ensure to always check for "fixed" as a final
	fallback.

2011-02-06  Bob Friesenhahn  <bfriesen@simple.dallas.tx.us>

	* config/delegates.mgk.in: Added gs-cmyk entry.  Used if '-type
	ColorSeparation' is specified on the command-line prior to the PDF
	or Postscript file name.  This entry specifies use of the
	Ghostscript PAM driver which is capable of supporting CMYK output.
	This may be useful if it is desired to apply CMYK color profiles
	to the image returned from the PDF.  As fair warning, it seems
	that Ghostscript 8.62 outputs CMYK even if the PDF was in RGB
	space if the PAM driver is used.

	* coders/pnm.c (ReadPNMImage): Add support for reading netpbm's
	PAM format.

2011-02-01  Bob Friesenhahn  <bfriesen@simple.dallas.tx.us>

	* tests/rwblob.c, tests/rwfile.c: Fixes to help tests work when
	testing with multiple frames.

	* coders/sgi.c: SGI format is not documented to support multiple
	frames.  Remove the half-baked extension for it.

2011-02-01  Glenn Randers-Pehrson  <glennrp@simple...>

	* coders/bmp.c (ReadBMPImage): Changed file_size greater than
	expected from a corrupt-image error to a debug log entry.
	File_size too small is still an error, and made that so also for
	BI_RGB images which were previously exempted from the test.

2011-01-30  Bob Friesenhahn  <bfriesen@simple.dallas.tx.us>

	* tests/rwblob.c, tests/rwfile.c: Validate the data in each image
	frame, validate that each read returns the same number of frames,
	and validate that the correct number of frames was ultimately
	returned.

	* magick/blob.c (SyncBlob): Disable bogus code which attempted to
	replicate the blob I/O object across all images in the list when
	the blob is synced.  Leave a less bogus bit of code in place (but
	commented out) in case such functionality is deemed to actually be
	needed in the future.  The previous code was copying structs on
	top of each other, including a pointer member to a semaphore.

2011-01-23  Bob Friesenhahn  <bfriesen@simple.dallas.tx.us>

	* www/Changes.rst: Add a new Changes page to wrap up the yearly
	change logs to lessen download size.

	* scripts/changelog2rst.sh: Simple utility to format ChangeLog
	format into something resembling reStructuredText.

	* www/Makefile.am: Use reStructuredText to format the ChangeLog
	files to HTML so that we can inherit the improved formatting and
	page style.

	* coders/pnm.c (ReadPNMImage): Support for multi-frame PNM was
	botched due to on-going edits to support PAM format.

2011-01-16  Bob Friesenhahn  <bfriesen@simple.dallas.tx.us>

	* wand/magick_wand.c (MagickDescribeImage): Was sending
	descriptive output to stdout rather than returning it in an
	allocated string as intended.

2011-01-09  Bob Friesenhahn  <bfriesen@simple.dallas.tx.us>

	* magick/draw.c, wand/drawing_wand.c (MvgPrintf): Update to handle
	C99 vsnprintf() return values.

	* magick/draw.c, wand/drawing_wand.c (DrawAnnotation): Linux
	glibc does not pass extended text characters if "%.1024s"
	formatting convention is used.  Apparently it assumes that such
	characters may be UTF8 and returns -1 rather than outputting the
	string, even if it is assured to fit.

